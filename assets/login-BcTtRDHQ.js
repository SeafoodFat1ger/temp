import"./index-BHh1TLVf.js";/* empty css              */import"./index-Dsav_6um.js";import{F as I}from"./index-46_qGGFH.js";import{N as U}from"./index-B-44DXlN.js";import{d as M,c as u,u as O,r as $,t as j,a as J,b as p,e as F,f as k,w,F as K,g as L,o as y,h as E}from"./index-BXgsGGBr.js";import{u as W,p as P,g as Y,s as T}from"./index-BAswO634.js";import{s as z}from"./select-seat-CFz2dJni.js";import{_ as D}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as G,u as H,n as Q,t as N,p as X,F as Z,w as x}from"./index-D5UzUt9W.js";import{B as ee}from"./index-BomqLrIU.js";import"./use-route-Cqe9Mgvt.js";import"./interceptor-B_IeSHt0.js";const[se,oe]=G("form"),te={colon:Boolean,disabled:Boolean,readonly:Boolean,required:[Boolean,String],showError:Boolean,labelWidth:Q,labelAlign:String,inputAlign:String,scrollToError:Boolean,scrollToErrorPosition:String,validateFirst:Boolean,submitOnEnter:N,showErrorMessage:N,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}};var ae=M({name:se,props:te,emits:["submit","failed"],setup(t,{emit:e,slots:f}){const{children:a,linkChildren:g}=H(Z),d=s=>s?a.filter(o=>s.includes(o.name)):a,v=s=>new Promise((o,r)=>{const n=[];d(s).reduce((R,A)=>R.then(()=>{if(!n.length)return A.validate().then(B=>{B&&n.push(B)})}),Promise.resolve()).then(()=>{n.length?r(n):o()})}),m=s=>new Promise((o,r)=>{const n=d(s);Promise.all(n.map(i=>i.validate())).then(i=>{i=i.filter(Boolean),i.length?r(i):o()})}),c=s=>{const o=a.find(r=>r.name===s);return o?new Promise((r,n)=>{o.validate().then(i=>{i?n(i):r()})}):Promise.reject()},b=s=>typeof s=="string"?c(s):t.validateFirst?v(s):m(s),l=s=>{typeof s=="string"&&(s=[s]),d(s).forEach(r=>{r.resetValidation()})},q=()=>a.reduce((s,o)=>(s[o.name]=o.getValidationStatus(),s),{}),V=(s,o)=>{a.some(r=>r.name===s?(r.$el.scrollIntoView(o),!0):!1)},h=()=>a.reduce((s,o)=>(o.name!==void 0&&(s[o.name]=o.formValue.value),s),{}),S=()=>{const s=h();b().then(()=>e("submit",s)).catch(o=>{e("failed",{values:s,errors:o});const{scrollToError:r,scrollToErrorPosition:n}=t;r&&o[0].name&&V(o[0].name,n?{block:n}:void 0)})},C=s=>{X(s),S()};return g({props:t}),W({submit:S,validate:b,getValues:h,scrollToField:V,resetValidation:l,getValidationStatus:q}),()=>{var s;return u("form",{class:oe(),onSubmit:C},[(s=f.default)==null?void 0:s.call(f)])}}});const re=x(ae),_=O(),le={name:"Login",setup(){const t=()=>e.passwordRepeat===e.password,e=$({username:"",password:"",passwordRepeat:"",type:"login"}),f=async g=>{e.type=="login"?P("/api/users/login/",{username:e.username,password:e.password},(d,v)=>{Y(`/api/users/get/${v}/`,(m,c)=>{_.auth.user=c,localStorage.setItem("user",JSON.stringify(c)),T(d),L.push("/home/act")},()=>{_.auth.user=null})}):P("/api/users/register/",{username:e.username,password:e.password},d=>{T(d),e.type="login"})},a=g=>{e.type=g};return{validator:t,...j(e),onSubmit:f,chanegType:a}}},ne={class:"auth"},ie={class:"form"},ue={style:{margin:"16px 0"}},de={class:"form"},me={style:{margin:"16px 0"}};function pe(t,e,f,a,g,d){const v=U,m=I,c=ee,b=re;return y(),J(K,null,[u(v,{title:t.type=="login"?"登录":"注册"},null,8,["title"]),p("div",ne,[e[9]||(e[9]=p("img",{class:"logo",src:z,alt:""},null,-1)),t.type=="login"?(y(),F(b,{key:0,class:"form-wrap",onSubmit:a.onSubmit},{default:w(()=>[p("div",ie,[u(m,{clearable:"",modelValue:t.username,"onUpdate:modelValue":e[0]||(e[0]=l=>t.username=l),name:"username",label:"账号",placeholder:"请输入账号",rules:[{required:!0,message:"请填写账户"}]},null,8,["modelValue"]),u(m,{clearable:"",modelValue:t.password,"onUpdate:modelValue":e[1]||(e[1]=l=>t.password=l),type:"password",name:"password",label:"密码",placeholder:"请输入密码",rules:[{required:!0,message:"请填写密码"}]},null,8,["modelValue"])]),p("div",ue,[u(c,{round:"",block:"",type:"primary","native-type":"submit"},{default:w(()=>e[7]||(e[7]=[E(" 登录 ")])),_:1}),p("p",{onClick:e[2]||(e[2]=l=>a.chanegType("register")),class:"change-btn"}," 没有账号，前往注册 ")])]),_:1},8,["onSubmit"])):k("",!0),t.type=="register"?(y(),F(b,{key:1,class:"form-wrap",onSubmit:a.onSubmit},{default:w(()=>[p("div",de,[u(m,{clearable:"",modelValue:t.username,"onUpdate:modelValue":e[3]||(e[3]=l=>t.username=l),name:"username",label:"账号",placeholder:"请输入账号",rules:[{required:!0,message:"请填写账号"}]},null,8,["modelValue"]),u(m,{clearable:"",modelValue:t.password,"onUpdate:modelValue":e[4]||(e[4]=l=>t.password=l),type:"password",name:"password",label:"密码",placeholder:"请输入密码",rules:[{required:!0,message:"请填写密码"}]},null,8,["modelValue"]),u(m,{clearable:"",modelValue:t.passwordRepeat,"onUpdate:modelValue":e[5]||(e[5]=l=>t.passwordRepeat=l),type:"password",name:"password",label:"确认密码",placeholder:"请确认密码",rules:[{required:!0,message:"请确认密码"},{validator:a.validator,message:"请检查密码是否相同"}]},null,8,["modelValue","rules"])]),p("div",me,[u(c,{round:"",block:"",type:"primary","native-type":"submit"},{default:w(()=>e[8]||(e[8]=[E(" 注册 ")])),_:1}),p("p",{onClick:e[6]||(e[6]=l=>a.chanegType("login")),class:"change-btn"},"登录已有账号")])]),_:1},8,["onSubmit"])):k("",!0)])],64)}const Ee=D(le,[["render",pe],["__scopeId","data-v-550d3dcf"]]);export{Ee as default};
