import{u as B,i as n,A as C,a as d,b as i,s as p,F as x,q as k,B as A,o as l,C as F}from"./index-BXgsGGBr.js";import{i as f}from"./index-DFpWVYxE.js";import{p as u,b as N}from"./index-BAswO634.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-D5UzUt9W.js";import"./interceptor-B_IeSHt0.js";const S={class:"profile-page"},T={class:"user-info"},E={class:"user-name"},J={class:"icon-row"},M=["onClick"],P={class:"icon"},L={__name:"profile",setup(U){const c=B(),h=F(),v=n([{name:"当前借阅",icon:"📖",path:"/home/profile_BooksList"},{name:"智能问答",icon:"🤖",path:"/home/hot"},{name:"借阅统计",icon:"📊",path:"/home/profile_History"},{name:"个人信息",icon:"👤",path:"/home/profile_info"}]),y=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];async function _(){const t=n([]);return new Promise((e,a)=>{u("/api//profile/timeData/",{userId:c.auth.user.userId},(s,o)=>{s==="操作成功"?(t.value=o.timeData,e(t)):a("Failed to fetch type data")})})}async function b(){const t=await _(),e=document.getElementById("borrow-time-chart"),a=f(e),s={title:{text:"借阅时间分布",left:"center"},xAxis:{type:"category",data:t.value.map(o=>y[o.month-1])},yAxis:{type:"value"},series:[{data:t.value.map(o=>o.borrowed),type:"bar",color:"rgba(115,192,222,0.78)"}]};a.setOption(s)}async function w(){const t=n([]);return new Promise((e,a)=>{u("/api/profile/typeData/",{userId:c.auth.user.userId},(s,o)=>{s==="操作成功"?(t.value=o.typeData,e(t)):a("Failed to fetch type data")})})}async function g(){const t=await w();t.value=t.value.filter(r=>r.borrowedNum>0);const e=document.getElementById("borrow-type-chart"),a=f(e),s=t.value.map(r=>({name:r.typename,value:r.proportion})),o={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:t.value.map(r=>r.typename)},series:[{name:"借阅类型",type:"pie",radius:"50%",data:s,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};a.setOption(o)}const m=n([]);async function D(){u("/api/profile/getUserInfo/",{userId:c.auth.user.userId},(t,e)=>{m.value=e.userInfo})}function I(t){t?h.push(t):N("功能开发中")}return C(()=>{D(),g(),b()}),(t,e)=>(l(),d("div",S,[i("div",T,[e[0]||(e[0]=i("div",{class:"user-avatar"},"👤",-1)),i("p",E,p(m.value.username),1)]),i("div",J,[(l(!0),d(x,null,k(v.value,(a,s)=>(l(),d("div",{key:s,class:"icon-item",onClick:o=>I(a.path)},[i("div",P,p(a.icon),1),i("p",null,p(a.name),1)],8,M))),128))]),e[1]||(e[1]=A('<div class="data-section" data-v-891bdc14><p class="section-title" data-v-891bdc14>借阅数据</p><div id="borrow-time-chart" class="chart-container" data-v-891bdc14></div><div id="borrow-type-chart" class="chart-container" data-v-891bdc14></div></div><div class="relationship-section" data-v-891bdc14><p class="section-title" data-v-891bdc14>我与图书馆</p><p data-v-891bdc14>这里是一些关于用户和图书馆的文字描述。</p></div>',2))]))}},$=O(L,[["__scopeId","data-v-891bdc14"]]);export{$ as default};
